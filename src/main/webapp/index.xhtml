<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns="http://www.w3.org/1999/xhtml">

    <h:head>

        <link rel="icon" type="image/x-icon" href="favicon.ico"/>

        <f:facet name="first">
            <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

            <meta http-equiv="Content-Type"    content="text/html; charset=UTF-8"/>
            <meta http-equiv="cache-control" content="max-age=0" />
            <meta http-equiv="cache-control" content="no-cache" />
            <meta http-equiv="expires" content="0" />
            <meta http-equiv="pragma" content="no-cache" />
            <meta charset="UTF-8" />

            <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
            <meta http-equiv="refresh" content="#{facesContext.externalContext.sessionMaxInactiveInterval};url=#{request.contextPath}/app/index.xhtml"/>
        </f:facet>

        <title>Agenda</title>


        <!-- CSS -->
        <h:outputStylesheet name="css/bootstrap-4.4.1.min.css"/>
        <h:outputStylesheet name="css/bootstrap-toggle.min.css" />

        <h:outputStylesheet name="css/font-awesome-5.11.2.min.css"/>
        <h:outputStylesheet name="css/all.min.css"/>
        <h:outputStylesheet name="css/brands.min.css"/>
        <h:outputStylesheet name="css/regular.min.css"/>
        <h:outputStylesheet name="css/solid.min.css"/>
        <h:outputStylesheet name="css/svg-with-js.min.css"/>
        <h:outputStylesheet name="css/v4-shims.min.css"/>

        <h:outputStylesheet name="css/adminlte-3.0.1.css"/>
        <h:outputStylesheet name="js/datepicker/datepicker3.css"/>
        <h:outputStylesheet name="js/daterangepicker/daterangepicker.css"/>
        <h:outputStylesheet name="js/datetimepicker/bootstrap-datetimepicker.css"/>

        <h:outputStylesheet name="css/ajax-status.min.css"/>
        <h:outputStylesheet name="css/main.css"/>
        <h:outputStylesheet name="css/main2.css"/>

        <h:outputStylesheet name="css/OverlayScrollbars.css"/>
        <h:outputStylesheet name="css/jquery-ui-min.css"/>      
        <h:outputStylesheet name="css/open-iconic.min.css"/>
        <h:outputStylesheet name="css/ionicons.min.css"/>
        <h:outputStylesheet library="primefaces" name="charts/charts.css"/>


        <!-- JAVASCRIPT -->
        <h:outputScript library="primefaces-extensions" name="primefaces-extensions.js"/>
        <h:outputScript library="primefaces" name="charts/charts.js"/>
        <h:outputScript name="js/jquery.min.js"/>
        <h:outputScript name="js/jquery-ui.min.js"/>
        <h:outputScript name="js/jquery.mask.min.js"/>        
        <h:outputScript name="js/bootstrap.bundle.js"/>

        <h:outputScript name="js/fontawesome.min.js"/>
        <h:outputScript name="js/all.min.js"/>
        <h:outputScript name="js/brands.min.js"/>
        <h:outputScript name="js/regular.min.js"/>
        <h:outputScript name="js/solid.min.js"/>
        <h:outputScript name="js/v4-shims.min.js"/>

        <h:outputScript name="js/datepicker/bootstrap-datepicker.es.js"/>
        <h:outputScript name="js/daterangepicker/moment-with-locales.js"/>
        <h:outputScript name="js/daterangepicker/daterangepicker.js"/>
        <h:outputScript name="js/datetimepicker/bootstrap-datetimepicker.js"/>
        <h:outputScript name="js/slimScroll/jquery.slimscroll.min.js"/>
        <h:outputScript name="js/fixviewstate.min.js"/>
        <h:outputScript name="js/main.js"/>

        <h:outputScript name="js/CardRefresh.js"/>
        <h:outputScript name="js/CardWidget.js"/>
        <h:outputScript name="js/ControlSidebar.js"/>
        <h:outputScript name="js/DirectChat.js"/>
        <h:outputScript name="js/Dropdown.js"/>
        <h:outputScript name="js/Layout.js"/>
        <h:outputScript name="js/OverlayScrollbars.min.js"/>
        <h:outputScript name="js/PushMenu.js"/>
        <h:outputScript name="js/SiteSearch.js"/>
        <h:outputScript name="js/Toasts.js"/>        
        <h:outputScript name="js/TodoList.js"/>
        <h:outputScript name="js/Treeview.js"/>  

        <h:outputScript name="js/jquery-qrcode.min.js"/>
        <h:outputScript name="js/bootstrap-toggle.min.js"/>

        <h:outputScript name="js/app.js"/>         

    </h:head>

    <h:body>

        <f:view locale="es_DO">

            <p:growl id="messages" showDetail="true" life="2000" class="ui-growl" />

            <div class="wrapper">

                <h:panelGroup id="content">

                    <!--<ui:include src="parcial/# {menuController.pagina}.xhtml" />-->

                    <div class="content-header">
                        <div class="container-fluid">
                            <div class="row mb-2">
                                <div class="col-sm-6">
                                    <h1 class="m-0 text-dark">Agenda de Contactos</h1>
                                </div>
                            </div><!-- /.row -->
                        </div><!-- /.container-fluid -->
                    </div>
                    <!-- /.content-header -->

                    <section class="content">
                        <div class="container-fluid">
                            <h:form id="form_contacto">
                                <div class="row">
                                    <!-- left column -->
                                    <div class="col-md-12">
                                        <!-- general form elements -->
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="card-title">Manejo de contactos</h3>
                                                <span class="border rounded float-right text-white bg-dark pr-2 pl-2"> <h:outputText id="reloj" value="#{relojBean.fechaHoraActual}"/> </span>
                                                <p:poll interval="5" immediate="true" listener="#{relojBean.obtenerFechaFormateada()}" update="reloj"/>
                                            </div>
                                            <!-- /.card-header -->

                                            <div class="card-body">
                                                <fieldset>

                                                    <p:growl id="messages" showDetail="true" life="6000"/>

                                                    <div class="row">

                                                        <div class="form-row col-md-10">

                                                            <div class="col-md-6">                                          
                                                                <div class="form-group required">
                                                                    <label class="control-label" for="nombre">Nombre</label>
                                                                    <h:inputText id="nombre" value="#{contactoBean.contacto.nombre}" autocomplete="off"
                                                                                 class="form-control input-sm #{component.findComponent('nombre').valid ? '' : 'is-invalid'}" required="true"
                                                                                 requiredMessage="Debe ingresar el nombre" />
                                                                </div>
                                                            </div>

                                                            <div class="col-md-6">
                                                                <div class="form-group required">
                                                                    <label class="control-label" for="telefono">Teléfono</label>
                                                                    <h:inputText id="telefono" value="#{contactoBean.contacto.telefono}" autocomplete="off"
                                                                                 class="form-control input-sm #{component.findComponent('telefono').valid ? '' : 'is-invalid'}" required="true"
                                                                                 requiredMessage="Debe ingresar el número de Teléfono" />
                                                                </div>                                                       
                                                            </div>

                                                            <div class="col-md-12">
                                                                <div class="form-group required">
                                                                    <label class="control-label" for="direccion">Dirección</label>
                                                                    <h:inputText id="direccion" value="#{contactoBean.contacto.direccion}" autocomplete="off"
                                                                                 class="form-control input-sm #{component.findComponent('direccion').valid ? '' : 'is-invalid'}" required="true"
                                                                                 requiredMessage="Debe ingresar la dirección" />
                                                                </div>
                                                            </div>

                                                        </div>

                                                        <div class="col-md-2 col-sm-12">
                                                            <p:commandLink id="btnGuardar" class="btn btn-sm btn-block btn-info" 
                                                                           actionListener="#{contactoBean.guardar()}"
                                                                           update="@form">
                                                                <i class="fas fa-save" aria-hidden="true"></i> #{contactoBean.contacto.id eq null ? 'Crear' : 'Actualizar'}
                                                            </p:commandLink>
                                                            <p:commandLink  id="btnCancelar" class="btn btn-sm btn-block btn-default"  
                                                                            immediate="true" resetValues="true" type="reset" update="@form"
                                                                            oncomplete="return false;"
                                                                            actionListener="#{contactoBean.limpiar()}">
                                                                <i class="fas fa-trash"></i> Nuevo 
                                                            </p:commandLink>
                                                        </div>

                                                    </div>

                                                </fieldset>
                                            </div>

                                        </div>
                                    </div>
                                </div>


                                <div class="card">
                                    <div class="card-header with-border">
                                        <h3 class="card-title">Lista de Contactos</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="col-sm-12">
                                            <div class="table-responsive">
                                                <p:dataTable id="contactosDataTable" var="contacto"
                                                             value="#{contactoBean.contactos}"
                                                             filteredValue="#{contactoBean.contactosFiltrados}"
                                                             paginator="true"
                                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                             currentPageReportTemplate="(Contactos: {endRecord} de {totalRecords}, Página: {currentPage} de {totalPages})"
                                                             rowsPerPageTemplate="25,50,100,500"
                                                             paginatorPosition="bottom"
                                                             rowKey="#{contacto.id}" 
                                                             selectionMode="single" 
                                                             rows="25"
                                                             scrollable="true"
                                                             widgetVar="contactosDataTable"
                                                             emptyMessage="No hay contactos para mostrar">

                                                    <p:ajax event="rowDblselect" listener="#{contactoBean.onRowSelectContacto}" update="form_contacto"/>                          

                                                    <f:facet name="header">
                                                        <p:outputPanel>
                                                            <h:outputText value="Buscar contacto: "/>
                                                            <p:inputText id="globalFilter" autocomplete="off" onkeyup="PF('contactosDataTable').filter()" style="max-width:150px" placeholder="Buscar"/>
                                                        </p:outputPanel>
                                                    </f:facet>	

                                                    <p:column headerText="NOMBRE" sortBy="#{contacto.nombre}" filterBy="#{contacto.nombre}" filterMatchMode="contains" filterStyle="display:none" class="centered">
                                                        <h:outputText value="#{contacto.nombre}" />
                                                    </p:column>
                                                    <p:column headerText="TELEFONO" sortBy="#{contacto.telefono}" filterBy="#{contacto.telefono}" filterMatchMode="contains" filterStyle="display:none" class="centered">
                                                        <h:outputText value="#{contacto.telefono}" />
                                                    </p:column>
                                                    <p:column headerText="DIRECCION" sortBy="#{contacto.direccion}" filterBy="#{contacto.direccion}" filterMatchMode="contains" filterStyle="display:none" class="centered">
                                                        <h:outputText value="#{contacto.direccion}" />
                                                    </p:column>
                                                    <p:column headerText="EDITAR"  exportable="false" class="centered">
                                                        <p:commandLink id="cmdEditar"
                                                                       class="btn btn-info btn-sm" 
                                                                       update="@form" 
                                                                       process="@this"
                                                                       action="#{contactoBean.setContacto(contacto)}">
                                                            <i class="fas fa-edit" aria-hidden="true"></i>
                                                        </p:commandLink>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </h:form>

                        </div>

                    </section>

                </h:panelGroup>

            </div>

            <p:ajaxStatus onstart="$('#statusDiv').show()" 
                          onsuccess="$('#statusDiv').hide()"/>

            <div class='loading-div' id="statusDiv" >
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>

        </f:view>        

    </h:body>


</html>